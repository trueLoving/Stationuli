# Stationuli 产品需求说明书（PRD）

**文档版本**：1.0  
**编写日期**：2025-01-29  
**项目名称**：Stationuli - 个人工作站 P2P 文件传输与控制解决方案

---

## 一、文档说明

### 1.1 文档目的

本文档系统描述 Stationuli 项目的产品需求，包括已实现功能、进行中功能与待实现功能，为产品迭代、开发排期和验收提供依据。

### 1.2 适用范围

- 产品经理、项目经理：需求理解与排期
- 开发工程师：功能实现与接口设计
- 测试工程师：用例设计与验收标准
- 运维与部署：运行环境与约束

### 1.3 术语与缩略语

| 术语                | 说明                                                                                 |
| ------------------- | ------------------------------------------------------------------------------------ |
| PRD                 | Product Requirements Document，产品需求说明书                                        |
| P2P                 | Peer-to-Peer，点对点                                                                 |
| mDNS                | Multicast DNS，组播 DNS，用于局域网设备发现                                          |
| Workbench           | 工作台：针对单台设备的整合界面，含文件传输、消息、控制、投影等（当前以文件传输为主） |
| DeviceApi / FileApi | common 包中定义的设备与文件接口抽象                                                  |
| EmptyState          | 未启动服务时的引导页，仅保留「启动服务」等关键操作                                   |
| Monorepo            | 单一代码库管理多包/多应用                                                            |

---

## 二、项目概述

### 2.1 项目背景

Stationuli 来源于三方面诉求：

1. **项目经验积累**：在离线环境（尤其 Android → PC）下的跨设备文件传输实践积累。
2. **个人真实需求**：作为开发者，需要一套可完全自主、离线优先的个人工作站方案。
3. **技术探索**：在 Rust 生态、跨平台开发、P2P 网络、系统集成等方面进行实践与验证。

### 2.2 产品定位

Stationuli 是一款**完全自主、完全离线、完全私密**的个人工作站解决方案，支持多平台原生应用：

- **桌面端（Desktop）**：Tauri + React，支持 Windows、macOS（含 Apple Silicon）
- **移动端（Mobile）**：Tauri + React，支持 Android（iOS 规划中）

**核心价值**：以局域网 P2P 为通信方式，实现设备发现、文件传输及后续的设备控制与投影能力，无第三方服务器、无云端账号，数据仅在用户设备间传输。

### 2.3 目标用户

- 个人开发者：多设备协同时需要快速、私密的文件与数据交换
- 技术爱好者：希望数据与连接完全自主可控、可离线使用
- 家庭/小团队：在局域网内共享文件、协同操作，无需公网或云服务

---

## 三、系统架构与技术栈

### 3.1 工程结构

```
Stationuli/
├── apps/
│   ├── desktop/          # 桌面端应用（Tauri + React）
│   └── mobile/           # 移动端应用（Tauri + React）
├── packages/
│   ├── common/           # 双端共享组件、Hooks、API 抽象、类型、Store
│   └── core/             # Rust 核心库（p2p、file、crypto、projection）
├── .github/
│   └── design/           # 设计文档、产品说明等
└── Cargo.toml / package.json
```

### 3.2 技术栈概览

| 层次       | 技术选型                                             | 说明                                     |
| ---------- | ---------------------------------------------------- | ---------------------------------------- |
| 前端框架   | React 19.x + TypeScript                              | 统一 UI 与逻辑                           |
| 构建工具   | Vite                                                 | Web 资源构建                             |
| 应用框架   | Tauri 2.0                                            | 桌面与移动端统一容器与系统调用           |
| 状态管理   | Zustand                                              | 轻量状态管理                             |
| 网络与传输 | Rust (packages/core)                                 | mDNS 发现、TCP 连接、文件分片与传输      |
| 安全       | X25519 + AES-256                                     | 端到端加密（设计已声明，实现依版本而定） |
| 工程与质量 | pnpm workspace、Vitest、Husky、Prettier、lint-staged | 构建、测试、格式化、提交检查             |

### 3.3 双端能力边界

| 能力                              | Desktop   | Mobile                |
| --------------------------------- | --------- | --------------------- |
| 服务启停（mDNS + TCP 监听）       | ✅        | ✅                    |
| 本机信息展示（IP、端口、设备 ID） | ✅        | ✅                    |
| mDNS 设备发现                     | ✅        | ✅                    |
| 手动添加/编辑/删除设备            | ✅        | ✅                    |
| 设备列表搜索与筛选                | ✅        | ✅                    |
| 测试连接                          | ✅        | ✅                    |
| 选择并发送文件（多选）            | ✅        | ✅（含 content URI）  |
| 接收文件列表与保存/删除           | ✅        | ✅                    |
| 传输进度与完成/接收通知           | ✅        | ✅                    |
| 工作台（按设备打开 + 文件传输）   | ✅        | ✅                    |
| 首页 / 设备页 / 历史页 / 设置页   | ✅        | ✅（历史/设置为占位） |
| 操作日志 / 传输历史               | ❌ 待实现 | ❌ 待实现             |
| 工作台内文本消息                  | ⏳ 规划中 | ⏳ 规划中             |
| 设备投影 / 设备控制 / 剪贴板同步  | ⏳ 规划中 | ⏳ 规划中             |
| 断点续传、发送方信息展示优化      | ⏳ 规划中 | ⏳ 规划中             |

---

## 四、功能需求

### 4.1 服务与发现（已实现）

**需求概述**：用户可启动/停止本机 P2P 服务（mDNS + TCP 监听），查看本机信息，并通过 mDNS 自动发现或手动添加方式管理设备列表。

#### 4.1.1 功能点

| 编号        | 需求描述                                                   | 优先级 | 实现状态 | 适用端         |
| ----------- | ---------------------------------------------------------- | ------ | -------- | -------------- |
| F-DISCO-001 | 支持启动服务：注册 mDNS、启动 TCP 监听、启动文件接收任务   | P0     | ✅       | Desktop/Mobile |
| F-DISCO-002 | 支持停止服务：停止 mDNS、释放 TCP 监听、结束接收任务       | P0     | ✅       | Desktop/Mobile |
| F-DISCO-003 | 展示本机 IP、端口、设备 ID，并支持复制                     | P0     | ✅       | Desktop/Mobile |
| F-DISCO-004 | 通过 mDNS 在局域网内自动发现设备并刷新列表                 | P0     | ✅       | Desktop/Mobile |
| F-DISCO-005 | 支持手动添加设备（名称、类型、ID、IP、端口），写入设备列表 | P0     | ✅       | Desktop/Mobile |
| F-DISCO-006 | 服务启停过程展示加载状态，防抖与超时保护                   | P1     | ✅       | Desktop/Mobile |
| F-DISCO-007 | 未启动服务时展示 EmptyState，仅保留「启动服务」入口        | P1     | ✅       | Desktop/Mobile |

#### 4.1.2 业务规则

- 默认服务端口为 8080（可配置），与 TCP 监听端口一致。
- 设备类型包括 desktop、mobile、unknown；mDNS 注册时按本端类型上报。
- 敏感信息（如本机 IP、设备 ID）仅用于本地展示与 P2P 通信，不上传第三方。

---

### 4.2 设备管理（已实现）

**需求概述**：对已发现的设备进行列表展示、搜索筛选、测试连接、编辑删除，并提供「文件传输」「工作台」等操作入口。

#### 4.2.1 功能点

| 编号      | 需求描述                                            | 优先级 | 实现状态 | 适用端         |
| --------- | --------------------------------------------------- | ------ | -------- | -------------- |
| F-DEV-001 | 以卡片形式展示设备（名称、地址、端口、类型）        | P0     | ✅       | Desktop/Mobile |
| F-DEV-002 | 支持按名称、地址搜索设备                            | P0     | ✅       | Desktop/Mobile |
| F-DEV-003 | 支持按全部/在线/离线筛选（当前逻辑可统一视为在线）  | P1     | ✅       | Desktop/Mobile |
| F-DEV-004 | 支持对指定设备发起「测试连接」，并给出成功/失败提示 | P0     | ✅       | Desktop/Mobile |
| F-DEV-005 | 支持编辑设备信息（名称、类型、地址、端口等）        | P0     | ✅       | Desktop/Mobile |
| F-DEV-006 | 支持删除设备                                        | P0     | ✅       | Desktop/Mobile |
| F-DEV-007 | 每个设备提供「文件传输」「工作台」入口              | P0     | ✅       | Desktop/Mobile |
| F-DEV-008 | 设备列表为空时展示空状态与「添加设备」引导          | P1     | ✅       | Desktop/Mobile |

#### 4.2.2 业务规则

- 测试连接通过 TCP 连接目标 address:port 判定，超时与错误需给出明确提示。
- 手动添加设备时，IP 与端口为必填，名称/类型/ID 为选填。

---

### 4.3 文件传输（已实现）

**需求概述**：用户可选择文件向指定设备发送，接收端自动落盘并展示在「接收的文件」列表中，支持另存与删除；发送与接收过程有进度与事件通知。

#### 4.3.1 发送

| 编号       | 需求描述                                                            | 优先级 | 实现状态 | 适用端         |
| ---------- | ------------------------------------------------------------------- | ------ | -------- | -------------- |
| F-FILE-S01 | 桌面端通过系统对话框选择文件，支持多选                              | P0     | ✅       | Desktop        |
| F-FILE-S02 | 移动端通过系统文件选择器或 content URI 选择文件并发送               | P0     | ✅       | Mobile         |
| F-FILE-S03 | 向指定设备的 address:port 发起单次/多次文件发送                     | P0     | ✅       | Desktop/Mobile |
| F-FILE-S04 | 大文件按分片（如 1MB）传输，协议含 StartTransfer / Chunk / Complete | P0     | ✅       | Desktop/Mobile |
| F-FILE-S05 | 发送过程可上报进度（如 transfer-progress、transfer-complete 事件）  | P1     | ✅       | Desktop/Mobile |

#### 4.3.2 接收

| 编号       | 需求描述                                                           | 优先级 | 实现状态 | 适用端         |
| ---------- | ------------------------------------------------------------------ | ------ | -------- | -------------- |
| F-FILE-R01 | 服务开启时持续监听 TCP，接收并解析传输协议消息                     | P0     | ✅       | Desktop/Mobile |
| F-FILE-R02 | 将接收文件落盘到应用数据目录（如 received_files）                  | P0     | ✅       | Desktop/Mobile |
| F-FILE-R03 | 接收完成后向前端发送 file-received 事件（含 file_path、file_name） | P0     | ✅       | Desktop/Mobile |
| F-FILE-R04 | 在「接收的文件」区域展示文件名、路径、大小、接收时间等             | P0     | ✅       | Desktop/Mobile |
| F-FILE-R05 | 支持将已接收文件另存到用户指定位置                                 | P0     | ✅       | Desktop/Mobile |
| F-FILE-R06 | 支持从列表中删除已接收文件记录                                     | P1     | ✅       | Desktop/Mobile |
| F-FILE-R07 | 支持在弹窗中查看单条接收文件详情                                   | P1     | ✅       | Desktop/Mobile |

#### 4.3.3 业务规则

- 传输协议：TCP + 自定义二进制协议，消息顺序为 StartTransfer → Chunk×N → Complete。
- 桌面端使用本地文件路径；Android 可使用 content URI，需持久化权限与合规读取。
- 接收文件默认保存在应用数据目录下 received_files，不覆盖同名文件时的策略以实现为准。

---

### 4.4 工作台（已实现主体）

**需求概述**：用户从设备卡片进入「工作台」后，打开针对该设备的专属界面；当前支持在工作台内选择并发送文件，预留「设备控制」「消息」「屏幕共享」等标签扩展。

#### 4.4.1 功能点

| 编号     | 需求描述                                                | 优先级 | 实现状态               | 适用端         |
| -------- | ------------------------------------------------------- | ------ | ---------------------- | -------------- |
| F-WS-001 | 从设备卡片点击「工作台」打开针对该设备的工作台界面      | P0     | ✅                     | Desktop/Mobile |
| F-WS-002 | 工作台内支持选择文件并发送到当前设备                    | P0     | ✅                     | Desktop/Mobile |
| F-WS-003 | 工作台提供关闭/返回入口，关闭后回到设备列表或上一级     | P0     | ✅                     | Desktop/Mobile |
| F-WS-004 | 预留「文件传输 / 设备控制 / 消息 / 屏幕共享」等标签结构 | P1     | ✅（结构在，部分占位） | Desktop/Mobile |
| F-WS-005 | 工作台内文本消息收发                                    | P0     | ⏳ 规划中              | Desktop/Mobile |
| F-WS-006 | 工作台内设备投影（屏幕镜像）                            | P1     | ⏳ 规划中              | Desktop/Mobile |
| F-WS-007 | 工作台内设备控制（键鼠、剪贴板等）                      | P1     | ⏳ 规划中              | Desktop/Mobile |

#### 4.4.2 业务规则

- 工作台绑定单台设备，入口为该设备的 address、port 等；关闭后不保持长连接状态（以当前实现为准）。
- 后续扩展时，消息、投影、控制等均在同一「工作台」内通过标签或分块呈现。

---

### 4.5 应用框架与页面（已实现）

**需求概述**：提供统一的布局、路由与页面结构，桌面端为侧栏 + 顶栏，移动端为底栏 + 顶栏；包含首页、设备页、历史页、设置页。

#### 4.5.1 功能点

| 编号      | 需求描述                                                             | 优先级 | 实现状态                           | 适用端         |
| --------- | -------------------------------------------------------------------- | ------ | ---------------------------------- | -------------- |
| F-APP-001 | 桌面端主布局：左侧边栏导航 + 顶部栏（含服务状态与启停）+ 主内容区    | P0     | ✅                                 | Desktop        |
| F-APP-002 | 移动端主布局：底部导航栏 + 顶部栏 + 主内容区                         | P0     | ✅                                 | Mobile         |
| F-APP-003 | 路由包含首页(/home)、设备(/devices)、历史(/history)、设置(/settings) | P0     | ✅                                 | Desktop/Mobile |
| F-APP-004 | 首页在服务已启动时展示「接收的文件」，未启动时引导先启动服务         | P0     | ✅                                 | Desktop/Mobile |
| F-APP-005 | 设备页承载设备管理、搜索筛选、添加设备弹窗、工作台入口               | P0     | ✅                                 | Desktop/Mobile |
| F-APP-006 | 历史页预留「传输历史」「设备历史」区块，具体功能待实现               | P1     | ⏳ 占位                            | Desktop/Mobile |
| F-APP-007 | 设置页预留「应用配置」区块，「关于」展示应用名、版本、描述           | P1     | ✅（关于已实现）/ ⏳（配置待实现） | Desktop/Mobile |
| F-APP-008 | 顶栏或等效区域展示服务状态（运行中/已停止）及启停按钮                | P0     | ✅                                 | Desktop/Mobile |

#### 4.5.2 业务规则

- 未启动服务时，EmptyState 仅保留「启动服务」；启动成功后自动进入主界面。
- 服务停止后仍停留在主界面，不强制退回 EmptyState。

---

### 4.6 共享层与基础设施（已实现）

**需求概述**：通过 packages/common 提供双端共用的 API 抽象、Hooks、UI 组件、状态管理与类型定义，保证 Desktop 与 Mobile 在业务逻辑与体验上可复用、可维护。

#### 4.6.1 功能点

| 编号        | 需求描述                                                                                  | 优先级 | 实现状态 | 适用端        |
| ----------- | ----------------------------------------------------------------------------------------- | ------ | -------- | ------------- |
| F-SHARE-001 | 定义 DeviceApi（startDiscovery、stopDiscovery、getDevices、addDevice、testConnection 等） | P0     | ✅       | common        |
| F-SHARE-002 | 定义 FileApi（selectFile、getFileName、getFileSize、sendFile、saveReceivedFile 等）       | P0     | ✅       | common        |
| F-SHARE-003 | 提供 useDiscovery / useDeviceDiscovery 等设备发现相关 Hook                                | P0     | ✅       | common        |
| F-SHARE-004 | 提供 useFileTransfer 等文件传输相关 Hook                                                  | P0     | ✅       | common        |
| F-SHARE-005 | 提供 ServiceStatusCard、DeviceCard、AddDeviceDialog、ReceivedFilesCard 等共享组件         | P0     | ✅       | common        |
| F-SHARE-006 | 提供设备与文件传输相关 Zustand Store 或等效状态管理                                       | P0     | ✅       | apps + common |
| F-SHARE-007 | 提供 DeviceInfo、ReceivedFile 等共享类型定义                                              | P0     | ✅       | common        |

#### 4.6.2 业务规则

- 各端通过 Adapter 实现 DeviceApi、FileApi（如 Tauri invoke 调用后端），UI 通过 variant（desktop/mobile）区分样式与布局。
- 新增跨端能力时，优先在 common 中补充类型与接口，再在各端实现。

---

### 4.7 核心库（Rust，已实现）

**需求概述**：packages/core 提供 mDNS 发现、TCP 连接、文件分片与传输、加密与投影等底层能力，供 Desktop 与 Mobile 的 Tauri 后端调用。

| 编号       | 需求描述                                                                  | 优先级 | 实现状态                                 | 说明                      |
| ---------- | ------------------------------------------------------------------------- | ------ | ---------------------------------------- | ------------------------- |
| F-CORE-001 | mDNS 服务注册与发现，维护设备列表（id、name、address、port、device_type） | P0     | ✅                                       | p2p/mdns                  |
| F-CORE-002 | TCP 监听与连接，用于文件传输及测试连接                                    | P0     | ✅                                       | p2p/tcp                   |
| F-CORE-003 | 文件分片（Chunk）、传输协议（StartTransfer/Chunk/Complete）与重组         | P0     | ✅                                       | file/chunk、file/transfer |
| F-CORE-004 | 断点续传相关数据结构与逻辑（resume）                                      | P1     | ✅（结构在）/ ⏳（端到端未全接通）       | file/resume               |
| F-CORE-005 | 加密与密钥交换（X25519、AES-256）供传输层使用                             | P1     | ✅（模块在）/ ⏳（与传输链路集成依版本） | crypto                    |
| F-CORE-006 | 投影/采集与流（projection），应用层暂未使用                               | P2     | ✅（模块在）                             | projection                |

---

### 4.8 传输历史与操作日志（待实现）

**需求概述**：记录并展示文件传输历史与关键操作，便于回溯与统计。

| 编号       | 需求描述                                         | 优先级 | 实现状态  | 适用端         |
| ---------- | ------------------------------------------------ | ------ | --------- | -------------- |
| F-HIST-001 | 记录每次发送/接收的文件、目标设备、时间、结果等  | P1     | ⏳ 待实现 | Desktop/Mobile |
| F-HIST-002 | 在历史页提供「传输历史」列表与筛选               | P1     | ⏳ 待实现 | Desktop/Mobile |
| F-HIST-003 | 记录设备添加/删除/编辑、服务启停等操作并支持查看 | P2     | ⏳ 待实现 | Desktop/Mobile |

---

### 4.9 文件传输增强（规划中）

**需求概述**：在现有单次/多选发送基础上，增强队列管理、进度展示、断点续传及接收侧体验。

| 编号       | 需求描述                                           | 优先级 | 实现状态      | 适用端         |
| ---------- | -------------------------------------------------- | ------ | ------------- | -------------- |
| F-FILE-E01 | 多文件发送队列管理，支持取消、重试                 | P1     | ⏳ 待实现     | Desktop/Mobile |
| F-FILE-E02 | 发送/接收过程展示进度条与速度、预计剩余时间        | P1     | ⏳ 待实现     | Desktop/Mobile |
| F-FILE-E03 | 大文件断点续传                                     | P1     | ⏳ 待实现     | Desktop/Mobile |
| F-FILE-E04 | 接收文件列表中展示发送方信息（设备名、IP、类型等） | P1     | ⏳ 待实现     | Desktop/Mobile |
| F-FILE-E05 | 接收文件预览（如图片预览）                         | P2     | ⏳ 待实现     | Desktop/Mobile |
| F-FILE-E06 | Android 侧 content URI 与流式传输的完整重设计      | P1     | ⏳ 见设计文档 | Mobile         |

---

## 五、非功能需求

### 5.1 性能

| 编号       | 需求描述                                                | 说明                                     |
| ---------- | ------------------------------------------------------- | ---------------------------------------- |
| NF-PERF-01 | 在典型家庭/办公局域网下，设备应在数秒内出现在发现列表中 | mDNS 与轮询间隔需权衡刷新频率与负载      |
| NF-PERF-02 | 大文件传输采用分片机制，避免单次整文件加载导致 OOM      | 当前默认 1MB 分片，见 packages/core/file |
| NF-PERF-03 | 启停服务、测试连接、发送文件等操作需有加载态与结果反馈  | 禁用按钮、Progress、Toast/Alert 等       |

### 5.2 安全与隐私

| 编号      | 需求描述                                                                          |
| --------- | --------------------------------------------------------------------------------- |
| NF-SEC-01 | 端到端加密采用 X25519 + AES-256，数据不经过第三方服务器（设计已声明，实现依版本） |
| NF-SEC-02 | 发现与传输仅在用户可控的局域网与本机进行，无云端账号与数据留存                    |
| NF-SEC-03 | 本机 IP、设备 ID、Token 等仅用于本地与 P2P，不向非用户指定服务上传                |

### 5.3 兼容性

| 编号         | 需求描述                                                      |
| ------------ | ------------------------------------------------------------- |
| NF-COMPAT-01 | Desktop：Windows 10+ x64；macOS Big Sur+（x64/Apple Silicon） |
| NF-COMPAT-02 | Mobile：Android 9.0+（API 28+），ARM64/ARMv7；iOS 待定        |
| NF-COMPAT-03 | 所有能力依赖两端安装原生客户端，不支持纯 Web 使用             |

### 5.4 可用性与可维护性

| 编号        | 需求描述                                                                                  |
| ----------- | ----------------------------------------------------------------------------------------- |
| NF-USAB-01  | 关键操作有明确反馈（成功/失败提示、加载态），错误信息便于用户理解与排查                   |
| NF-MAINT-01 | 公共逻辑与 UI 沉淀在 packages/common，双端通过 DeviceApi/FileApi 与 variant 复用          |
| NF-MAINT-02 | 同一大版本内，Desktop 与 Mobile 在「设备发现 + 文件传输」协议与行为上保持一致，以保障互通 |

---

## 六、与第三方服务的关系

Stationuli **不依赖任何第三方业务服务**：设备发现与文件传输均在局域网内通过 mDNS 与 TCP 完成，无中心服务器、无云端账号。若未来增加「可选后端」（如中继、账号体系），需在本 PRD 中单独补充对接需求与能力边界。

---

## 七、需求优先级说明

- **P0**：核心流程，无则产品不可用或价值明显受损。
- **P1**：重要功能，影响体验与差异化。
- **P2**：增强功能，可后续迭代。

---

## 八、附录

### 8.1 相关文档

- [项目 README](../../README.md)
- [Common 包](../../packages/common/)
- [Core 库](../../packages/core/)

### 8.2 修订历史

| 版本 | 日期       | 变更说明                                                             | 作者 |
| ---- | ---------- | -------------------------------------------------------------------- | ---- |
| 1.0  | 2025-01-29 | 按 Pixuli PRD 格式重写，补充编号、优先级、实现状态、适用端及业务规则 | —    |

---

_本文档随项目迭代更新，请以代码与最新设计文档为准。_
