# 新交互流程设计文档

## 一、整体布局

### 1.1 桌面端（PC）主界面结构

```
┌─────────────────────────────────────────────────────────────┐
│                    服务状态区域（顶部）                        │
│  ┌───────────────────────────────────────────────────────┐  │
│  │  服务状态: [运行中/已停止]                              │  │
│  │  [启动服务] [停止服务] [添加设备]                      │  │
│  │  本设备信息: IP:端口, 设备ID                            │  │
│  └───────────────────────────────────────────────────────┘  │
│                                                               │
│                    设备列表区域（中间）                        │
│  ┌───────────────────────────────────────────────────────┐  │
│  │  设备1  [图标] 名称 地址:端口 类型                    │  │
│  │         [测试连接] [文件传输] [工作台]                │  │
│  ├───────────────────────────────────────────────────────┤  │
│  │  设备2  [图标] 名称 地址:端口 类型                    │  │
│  │         [测试连接] [文件传输] [工作台]                │  │
│  └───────────────────────────────────────────────────────┘  │
│                                                               │
│                    接收的文件区域（底部）                      │
│  ┌───────────────────────────────────────────────────────┐  │
│  │  接收的文件 (数量)                                      │  │
│  │  - 文件1 [下载]                                        │  │
│  │    来自: 设备名称 (IP:端口)                            │  │
│  │  - 文件2 [下载]                                        │  │
│  │    来自: 设备名称 (IP:端口)                            │  │
│  └───────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘

注：添加设备通过点击"添加设备"按钮打开弹窗
```

### 1.2 移动端主界面结构

```
┌─────────────────────────────────────┐
│        服务状态卡片（顶部）           │
│  ┌───────────────────────────────┐  │
│  │  服务状态: [运行中/已停止]      │  │
│  │  [启动服务] [停止服务]          │  │
│  │  [添加设备]                     │  │
│  │  本设备信息: IP:端口            │  │
│  │  设备ID: xxx                    │  │
│  └───────────────────────────────┘  │
│                                      │
│        设备列表区域（中间）           │
│  ┌───────────────────────────────┐  │
│  │  设备1                         │  │
│  │  [图标] 名称                   │  │
│  │  地址:端口 | 类型              │  │
│  │  [测试连接] [文件传输] [工作台] │  │
│  ├───────────────────────────────┤  │
│  │  设备2                         │  │
│  │  [图标] 名称                   │  │
│  │  地址:端口 | 类型              │  │
│  │  [测试连接] [文件传输] [工作台] │  │
│  └───────────────────────────────┘  │
│                                      │
│        接收的文件区域（底部）         │
│  ┌───────────────────────────────┐  │
│  │  接收的文件 (数量)              │  │
│  │  - 文件1 [下载]                │  │
│  │    来自: 设备名称 (IP:端口)    │  │
│  │  - 文件2 [下载]                │  │
│  │    来自: 设备名称 (IP:端口)    │  │
│  └───────────────────────────────┘  │
└─────────────────────────────────────┘

注：
- 移动端采用垂直滚动布局
- 按钮采用全宽或较大触摸区域
- 首次打开应用显示 EmptyState（只显示启动服务按钮）
- 启动服务后自动切换到应用主页
- 添加设备通过服务状态卡片中的"添加设备"按钮打开弹窗
```

## 二、功能命名（正式确定）

### 主要功能按钮命名

- **测试连接**：测试设备连接是否成功
- **文件传输**：快速发送文件入口（支持多选）
- **工作台**（正式命名）：集成所有交互功能的完整界面
  - 当前功能：文字发送、文件传输、消息接收
  - 后续将集成：设备投影、设备控制、远程操作等功能

## 三、详细交互流程

### 1. 启动服务流程（首次使用）

#### 桌面端和移动端通用流程

```
用户打开软件
    ↓
显示 EmptyState 界面（只显示启动服务按钮）
    ↓
用户点击"启动服务"按钮
    ↓
系统验证：
  - 端口是否可用
  - 网络权限是否授予
    ↓
开始启动服务：
  - 显示加载状态（按钮显示"启动中..."）
  - 初始化 mDNS 服务
  - 启动 TCP 监听器
  - 启动文件接收任务
    ↓
启动成功：
  - 自动切换到应用主页
  - 显示服务状态卡片（运行中）
  - 显示本设备信息（IP:端口、设备ID）
  - 显示设备列表区域（空状态）
  - 显示接收文件区域（可接收文件）
```

### 2. 添加设备流程

#### 桌面端和移动端通用流程

```
用户在应用主页（服务已启动）
    ↓
点击服务状态卡片中的"添加设备"按钮
    ↓
弹出添加设备对话框（弹窗形式）
    ↓
用户填写设备信息：
  - 设备名称（可选）
  - 设备类型（可选，默认"未知"）
  - 设备ID（可选）
  - IP地址（必填）
  - 端口（必填，默认8080）
    ↓
点击"添加"按钮
    ↓
系统验证输入：
  - IP地址格式验证
  - 端口范围验证（1-65535）
    ↓
添加设备到列表
    ↓
关闭弹窗，设备出现在设备列表中
    ↓
（可选）自动测试连接
```

#### 移动端特殊考虑

- 弹窗采用全屏或接近全屏设计，便于输入
- 输入框使用较大的触摸区域
- 支持软键盘自动弹出和收起
- 添加成功后显示成功提示

### 3. 测试连接流程

#### 桌面端和移动端通用流程

```
用户在设备列表中点击"测试连接"按钮
    ↓
显示加载状态（按钮显示"测试中..."或显示加载动画）
    ↓
系统尝试连接目标设备
    ↓
连接结果：
  ├─ 成功：显示成功提示（如："✅ 连接成功"）
  └─ 失败：显示错误提示（包含详细错误信息）
    ↓
恢复按钮状态
```

#### 移动端特殊考虑

- 使用 Toast 或 Snackbar 显示提示信息（不阻塞界面）
- 按钮在测试过程中显示加载动画
- 错误信息采用友好的提示方式，避免长文本遮挡界面

**注意**：测试连接**不会**打开工作台

### 4. 文件传输流程（快速入口）

#### 桌面端流程

```
用户在设备列表中点击"文件传输"按钮
    ↓
弹出文件选择对话框（系统原生对话框，支持多选）
    ↓
用户选择一个或多个文件
    ↓
点击"打开"或"确定"
    ↓
系统验证：
  - 设备地址和端口是否有效
  - 文件是否存在
  - 文件是否可读
    ↓
开始发送文件：
  - 显示发送进度（进度条或百分比）
  - 支持多个文件队列发送
  - 显示当前发送的文件名
    ↓
发送完成：
  - 显示成功提示
  - 清空选择状态
```

#### 移动端流程

```
用户在设备列表中点击"文件传输"按钮
    ↓
打开文件选择器（Android/iOS 原生文件选择器）
    ↓
用户选择一个或多个文件
    ↓
确认选择
    ↓
系统验证：
  - 设备地址和端口是否有效
  - 文件权限是否可用（Android content URI）
  - 文件是否可读
    ↓
开始发送文件：
  - 显示发送进度（顶部通知栏或应用内进度条）
  - 支持多个文件队列发送
  - 显示当前发送的文件名和进度
    ↓
发送完成：
  - 显示成功 Toast 提示
  - 清空选择状态
```

#### 移动端特殊考虑

- 使用系统原生文件选择器，支持访问相册、文档等
- 进度显示在应用内，不阻塞用户操作
- 支持后台发送（可选）
- 大文件发送时显示预计剩余时间

**注意**：文件传输**不会**打开工作台，是快速发送入口

### 5. 工作台流程（完整交互中心）

#### 桌面端流程

```
用户在设备列表中点击"工作台"按钮
    ↓
打开工作台界面（全屏覆盖或大窗口）
    ↓
工作台界面布局：
  ├─ 顶部：设备信息栏
  │   - 设备图标和名称
  │   - 连接状态指示器
  │   - 关闭按钮（X）
  │
  ├─ 中间：消息/交互区域（可滚动）
  │   - 文本消息列表（气泡样式）
  │   - 文件消息列表（带预览和下载）
  │   - 系统消息（连接状态、操作记录等）
  │   - （未来）设备投影区域
  │   - （未来）设备控制面板
  │
  └─ 底部：输入/操作区域
      - 文本输入框（支持多行）
      - 文件上传按钮（回形针图标）
      - 发送按钮
      - （未来）设备控制按钮组
      - （未来）投影按钮
    ↓
用户可以在工作台中：
  - 发送文本消息（Enter 发送，Shift+Enter 换行）
  - 发送文件（点击按钮选择或拖拽）
  - 接收文本消息（自动显示）
  - 接收文件并下载（点击下载按钮）
  - （未来）进行设备投影
  - （未来）进行设备控制
    ↓
点击关闭按钮或点击外部区域（遮罩层）
    ↓
关闭工作台，返回主界面
```

#### 移动端流程

```
用户在设备列表中点击"工作台"按钮
    ↓
打开工作台界面（全屏覆盖）
    ↓
工作台界面布局：
  ├─ 顶部：设备信息栏（固定）
  │   - 设备图标和名称
  │   - 连接状态指示器
  │   - 返回/关闭按钮（左上角）
  │
  ├─ 中间：消息/交互区域（可滚动，占主要空间）
  │   - 文本消息列表（气泡样式，左右对齐）
  │   - 文件消息列表（带预览和下载）
  │   - 系统消息（连接状态、操作记录等）
  │   - （未来）设备投影区域（可切换视图）
  │   - （未来）设备控制面板（标签页形式）
  │
  └─ 底部：输入/操作区域（固定，键盘上方）
      - 文本输入框（单行，点击展开）
      - 文件上传按钮（回形针图标）
      - 发送按钮
      - （未来）功能切换标签（文本/文件/投影/控制）
    ↓
用户可以在工作台中：
  - 发送文本消息（点击发送按钮）
  - 发送文件（点击按钮选择）
  - 接收文本消息（自动显示，自动滚动）
  - 接收文件并下载（点击下载按钮）
  - （未来）进行设备投影（全屏或分屏）
  - （未来）进行设备控制（触摸控制）
    ↓
点击返回按钮或滑动返回（iOS/Android 手势）
    ↓
关闭工作台，返回主界面
```

#### 移动端特殊考虑

- **全屏显示**：工作台占据整个屏幕，提供沉浸式体验
- **键盘适配**：输入框固定在底部，键盘弹出时自动调整布局
- **触摸优化**：按钮使用较大的触摸区域（至少 44x44px）
- **手势支持**：支持滑动返回（iOS/Android 系统手势）
- **消息滚动**：新消息自动滚动到底部，支持手动滚动查看历史
- **文件预览**：图片文件支持预览，其他文件显示图标和大小
- **网络状态**：显示连接状态，断线时提示用户

### 6. 接收文件流程

#### 桌面端流程

```
系统接收到文件
    ↓
自动保存到应用数据目录（received_files）
    ↓
在"接收的文件"区域显示新文件
    ↓
显示文件信息：
  - 文件名
  - 文件大小
  - 接收时间
  - 发送方信息：
    * 设备名称
    * 设备IP地址
    * 设备类型（桌面端/移动端）
    * 接收时间戳
    ↓
用户点击"下载"或"保存"按钮
    ↓
弹出文件保存对话框（系统原生）
    ↓
用户选择保存位置
    ↓
文件保存到指定位置
    ↓
显示成功提示
```

#### 移动端流程

```
系统接收到文件
    ↓
自动保存到应用数据目录（received_files）
    ↓
在"接收的文件"区域显示新文件
    ↓
显示文件信息：
  - 文件图标（根据类型）
  - 文件名
  - 文件大小
  - 接收时间
  - 发送方信息：
    * 设备名称
    * 设备IP地址
    * 设备类型（桌面端/移动端）
    * 接收时间戳
    ↓
用户点击文件项或"下载"按钮
    ↓
Android: 使用系统文件选择器选择保存位置
iOS: 使用系统分享菜单保存到文件应用
    ↓
文件保存到指定位置
    ↓
显示成功 Toast 提示
```

#### 移动端特殊考虑

- **文件预览**：图片文件支持点击预览，其他文件显示图标
- **快速操作**：长按文件项显示操作菜单（保存、分享、删除等）
- **通知提醒**：接收到新文件时显示通知（可选，包含发送方信息）
- **存储管理**：显示已接收文件的总大小，支持清理功能
- **发送方信息**：显示发送设备的名称、IP地址和类型，便于识别文件来源

### 7. 启动/停止服务流程

#### 桌面端和移动端通用流程

#### 7.1 首次启动服务

```
用户打开软件
    ↓
显示 EmptyState 界面（只显示启动服务按钮）
    ↓
用户点击"启动服务"按钮
    ↓
系统验证：
  - 端口是否可用
  - 网络权限是否授予
    ↓
开始启动服务：
  - 显示加载状态（按钮显示"启动中..."）
  - 初始化 mDNS 服务
  - 启动 TCP 监听器
  - 启动文件接收任务
    ↓
启动成功：
  - 自动切换到应用主页
  - 更新服务状态为"运行中"
  - 显示本设备信息（IP:端口、设备ID）
  - 显示绿色状态指示器
  - 显示设备列表区域（空状态）
  - 显示接收文件区域（可接收文件）
```

#### 7.2 停止服务

```
用户在应用主页（服务运行中）
    ↓
点击服务状态卡片中的"停止服务"按钮
    ↓
开始停止服务：
  - 显示加载状态（按钮显示"停止中..."）
  - 停止 mDNS 服务
  - 清理 TCP 监听器
  - 等待文件接收任务退出
    ↓
停止成功：
  - 更新服务状态为"已停止"
  - 隐藏本设备信息
  - 按钮变为"启动服务"
  - 保持在应用主页（不返回 EmptyState）
```

#### 7.3 重新启动服务

```
用户在应用主页（服务已停止）
    ↓
点击服务状态卡片中的"启动服务"按钮
    ↓
系统验证和启动（同 7.1）
    ↓
启动成功：
  - 更新服务状态为"运行中"
  - 显示本设备信息
  - 显示绿色状态指示器
```

#### 移动端特殊考虑

- **权限请求**：首次启动服务时请求网络权限（Android）
- **后台运行**：服务可以在后台运行，接收文件和消息
- **状态持久化**：应用重启后可以自动恢复服务状态（可选）
- **省电优化**：长时间无活动时降低服务频率（可选）

#### 界面切换说明

- **EmptyState → 应用主页**：启动服务成功后自动切换
- **应用主页 → EmptyState**：不会自动切换（停止服务后仍显示应用主页）
- **接收文件**：服务启动后即可接收文件，即使没有设备也能接收
- **添加设备**：在应用主页的服务状态卡片中，点击"添加设备"按钮

## 四、界面状态说明

### 4.1 应用界面状态

1. **EmptyState 界面（服务未启动）**
   - 显示欢迎界面
   - 只显示"启动服务"按钮
   - 不显示其他功能区域
   - 点击启动服务后自动切换到应用主页

2. **应用主页（服务已启动）**
   - 显示服务状态卡片（顶部）
   - 显示设备列表区域（中间）
   - 显示接收文件区域（底部）
   - 服务状态卡片包含：启动/停止服务、添加设备按钮

### 4.2 服务状态区域

1. **服务已停止（在应用主页）**
   - 显示"已停止"状态
   - "启动服务"按钮可用
   - "添加设备"按钮可用
   - 不显示本设备信息

2. **服务启动中**
   - 显示"启动中..."状态
   - "启动服务"按钮显示加载动画，禁用
   - "添加设备"按钮禁用

3. **服务运行中**
   - 显示"运行中"状态，带绿色指示器
   - "停止服务"按钮可用
   - "添加设备"按钮可用
   - 显示本设备信息（IP:端口、设备ID）

4. **服务停止中**
   - 显示"停止中..."状态
   - "停止服务"按钮显示加载动画，禁用
   - "添加设备"按钮禁用

### 4.3 设备列表项状态

1. **正常状态**
   - 显示设备信息
   - 三个按钮可用（测试连接、文件传输、工作台）

2. **连接测试中**
   - "测试连接"按钮显示加载状态
   - 其他按钮可用（不阻塞）

3. **文件传输中**
   - "文件传输"按钮显示进度或禁用
   - 其他按钮可用

4. **工作台已打开**
   - 可显示工作台图标高亮或标记
   - 所有按钮可用（工作台是独立窗口/全屏）

### 4.4 接收文件区域状态

1. **无文件状态**
   - 显示空状态提示
   - 显示图标和提示文字

2. **有文件状态**
   - 显示文件列表
   - 每个文件项显示下载按钮
   - 显示文件总数

3. **文件下载中**
   - 下载按钮显示加载状态
   - 显示下载进度（可选）

## 五、功能优先级

### 第一阶段（当前实现）

- ✅ 服务状态管理（启动/停止服务）
- ✅ 添加设备（弹窗形式）
- ✅ 设备列表显示
- ✅ 测试连接功能
- ✅ 文件传输快速入口（单文件）
- ✅ 工作台基础功能（文本+文件）
- ✅ 接收文件列表显示
- ✅ 文件下载功能

### 第二阶段（后续扩展）

- ⏳ 文件传输支持多选
- ⏳ 文件传输队列管理
- ⏳ 文件传输进度显示优化
- ⏳ 接收文件预览功能
- ⏳ 工作台集成设备投影
- ⏳ 工作台集成设备控制
- ⏳ 工作台集成更多交互功能
- ⏳ 多设备工作台管理（标签页）

## 六、移动端特殊设计考虑

### 6.1 整体布局策略

#### 6.1.1 屏幕尺寸适配

- **小屏手机（320px - 480px）**
  - 服务状态卡片：垂直堆叠按钮，全宽布局
  - 设备列表：每个设备项占满宽度，信息垂直排列
  - 按钮组：三个按钮垂直排列或使用图标+文字紧凑布局
  - 接收文件区域：可折叠，节省屏幕空间

- **中等屏幕（481px - 768px）**
  - 服务状态卡片：按钮可以横向排列
  - 设备列表：可以显示更多信息
  - 按钮组：可以横向排列，但保持足够间距

- **大屏平板（769px+）**
  - 可以采用类似桌面端的布局
  - 利用更多横向空间
  - 可以考虑分栏布局

#### 6.1.2 安全区域适配

- **iOS 适配**
  - 顶部：适配刘海屏和状态栏（safe-area-inset-top）
  - 底部：适配 Home Indicator 区域（safe-area-inset-bottom）
  - 使用 `padding-top: env(safe-area-inset-top)` 和 `padding-bottom: env(safe-area-inset-bottom)`

- **Android 适配**
  - 适配状态栏高度（StatusBar height）
  - 适配导航栏高度（NavigationBar height）
  - 使用系统 API 获取实际高度

#### 6.1.3 横竖屏适配

- **竖屏模式（默认）**
  - 垂直滚动布局
  - 所有内容区域垂直排列
  - 工作台全屏显示

- **横屏模式**
  - 工作台可以利用更多横向空间
  - 设备列表可以考虑两列布局（如果屏幕足够大）
  - 消息列表在横屏时可以显示更多内容

### 6.2 交互优化

#### 6.2.1 触摸优化

- **按钮尺寸**
  - 最小触摸区域：44x44px（iOS 标准）或 48x48dp（Android 标准）
  - 按钮间距：至少 8px，避免误触
  - 按钮文字：清晰可读，至少 14px

- **手势支持**
  - **滑动操作**：设备列表项支持左滑显示删除按钮（可选）
  - **长按菜单**：长按设备项显示操作菜单（编辑、删除、复制信息等）
  - **下拉刷新**：设备列表支持下拉刷新（可选）
  - **滑动返回**：工作台支持 iOS 滑动返回手势

- **触摸反馈**
  - 按钮点击时显示视觉反馈（缩放或高亮）
  - 使用系统触觉反馈（Haptic Feedback）

#### 6.2.2 键盘处理

- **输入框适配**
  - 输入框聚焦时自动滚动到可见区域
  - 键盘弹出时调整布局，避免遮挡输入框
  - 使用 `scrollIntoView` 或 `scrollTo` 确保输入框可见

- **键盘类型**
  - IP地址输入：使用数字键盘
  - 端口输入：使用数字键盘
  - 文本消息输入：使用标准键盘
  - 设备名称输入：使用标准键盘

- **键盘操作**
  - 支持键盘的"完成"或"发送"按钮提交
  - 工作台输入框：支持 Enter 发送（如果键盘支持）
  - 添加设备表单：支持 Tab 键切换输入框

#### 6.2.3 手势支持

- **系统手势**
  - iOS：支持从屏幕左边缘滑动返回
  - Android：支持系统返回键和手势返回
  - 工作台：支持滑动关闭（从顶部向下滑动）

- **自定义手势**
  - 设备列表：支持下拉刷新
  - 消息列表：支持上拉加载更多（如果消息很多）
  - 文件列表：支持长按显示操作菜单

### 6.3 性能优化

#### 6.3.1 列表优化

- **虚拟滚动**
  - 设备列表：如果设备数量超过 50 个，使用虚拟滚动
  - 消息列表：如果消息数量超过 100 条，使用虚拟滚动
  - 文件列表：如果文件数量超过 50 个，使用虚拟滚动

- **懒加载**
  - 接收文件列表：初始只加载前 20 个，滚动时加载更多
  - 图片文件：使用缩略图，点击时加载原图
  - 文件预览：按需加载，不预加载所有文件

- **缓存策略**
  - 设备列表：缓存设备信息，减少重复请求
  - 文件列表：缓存文件元数据（名称、大小等）
  - 图片缓存：使用浏览器缓存或应用缓存

#### 6.3.2 网络优化

- **文件传输**
  - 大文件传输时显示进度和预计剩余时间
  - 支持断点续传（大文件，>10MB）
  - 网络错误时自动重试（最多 3 次）
  - 支持后台传输（可选，使用 Service Worker 或 Background Task）

- **消息同步**
  - 消息列表增量更新，不重新加载全部
  - 使用 WebSocket 或长轮询保持连接
  - 网络断开时显示离线提示

#### 6.3.3 存储优化

- **文件管理**
  - 接收文件定期清理（可选，如 30 天未访问）
  - 显示存储使用情况（已接收文件总大小）
  - 支持手动清理缓存和临时文件
  - 大文件提示用户及时保存或删除

- **数据持久化**
  - 设备列表保存到本地存储
  - 服务状态保存到本地存储（可选）
  - 使用 IndexedDB 或 SQLite 存储大量数据

## 七、用户体验优化建议

### 7.1 通用优化

1. **创建设备**
   - 支持回车键快速提交（桌面端）
   - 添加设备后自动清空表单
   - 显示最近使用的IP地址（可选）
   - 支持扫描二维码添加设备（未来）

2. **设备列表**
   - 支持设备排序（按名称、类型、添加时间）
   - 支持设备搜索/过滤
   - 支持设备编辑和删除
   - 显示设备连接状态（在线/离线）

3. **文件传输**
   - 显示传输进度和速度
   - 支持取消传输
   - 显示传输历史
   - 支持断点续传（大文件）

4. **工作台**
   - 支持多个设备同时打开多个工作台（标签页形式，桌面端）
   - 支持工作台最小化/最大化（桌面端）
   - 支持工作台历史记录
   - 支持消息搜索和过滤

### 7.2 移动端特定优化

#### 7.2.1 通知系统

- **推送通知**
  - 接收到新文件时显示通知（可选，用户可设置）
  - 接收到新消息时显示通知（工作台关闭时）
  - 服务状态变化时显示通知（启动/停止服务）
  - 连接状态变化时显示通知（设备上线/下线）

- **应用内通知**
  - 使用 Toast 或 Snackbar 显示短暂提示
  - 文件传输完成时显示 Toast
  - 连接测试结果使用 Toast 显示
  - 错误信息使用友好的 Toast 提示

#### 7.2.2 快捷操作

- **系统集成**
  - Android：支持桌面快捷方式（快速启动服务）
  - iOS：支持小组件显示服务状态（未来）
  - 支持快速分享文件到其他应用（系统分享菜单）
  - 支持从其他应用分享文件到 Stationuli

- **快捷功能**
  - 长按应用图标显示快捷菜单（启动服务、添加设备等）
  - 支持应用内搜索（搜索设备、文件等）
  - 支持语音输入（文本消息，可选）

#### 7.2.3 离线支持

- **离线状态**
  - 检测网络连接状态（在线/离线）
  - 离线时显示友好提示和图标
  - 支持离线查看已接收文件
  - 支持离线查看设备列表（已保存的设备）

- **自动重连**
  - 网络恢复后自动重连服务
  - 自动恢复文件传输（如果支持断点续传）
  - 显示重连状态和进度

#### 7.2.4 移动端特有功能

- **相机集成**
  - 支持拍照后直接发送（工作台中）
  - 支持从相册选择图片发送
  - 支持录制视频发送（未来）

- **位置服务**
  - 支持发送位置信息（未来）
  - 支持设备位置追踪（未来）

- **生物识别**
  - 支持指纹/面容解锁（保护隐私，可选）
  - 敏感操作需要验证（删除设备、停止服务等）

## 八、技术实现要点

### 8.1 桌面端实现

1. **服务状态管理**
   - 使用 ServiceStatusCard 组件
   - 集成启动/停止服务功能
   - 显示本设备信息

2. **设备添加**
   - 使用 AddDeviceDialog 弹窗组件
   - 表单验证和错误提示
   - 响应式布局

3. **设备列表**
   - 列表项布局优化（左侧信息，右侧按钮）
   - 按钮组样式统一（测试连接、文件传输、工作台）
   - 支持空状态显示

4. **文件传输快速入口**
   - 文件选择器支持多选
   - 文件队列管理
   - 传输进度显示（通知或状态栏）

5. **工作台**
   - 全屏覆盖或大窗口
   - 保持现有聊天室功能
   - 预留扩展接口（投影、控制等）
   - 支持多实例（标签页）

6. **接收文件列表**
   - 使用 ReceivedFilesCard 组件
   - 显示文件信息和下载按钮
   - 支持文件预览（图片）

### 8.2 移动端实现

1. **服务状态管理**
   - 使用 ServiceStatusCard 组件（移动端样式）
   - 适配小屏幕布局
   - 按钮使用全宽或较大尺寸

2. **设备添加**
   - 使用 AddDeviceDialog 弹窗组件（移动端样式）
   - 全屏或接近全屏设计
   - 适配软键盘弹出

3. **设备列表**
   - 垂直布局，每个设备项占一行
   - 按钮使用全宽或较大触摸区域
   - 支持下拉刷新（可选）

4. **文件传输快速入口**
   - 使用系统原生文件选择器
   - Android 使用 content URI
   - iOS 使用文件应用
   - 显示传输进度（Toast 或应用内）

5. **工作台**
   - 全屏覆盖
   - 适配键盘弹出
   - 支持滑动返回
   - 消息列表使用虚拟滚动（如果消息很多）

6. **接收文件列表**
   - 使用 ReceivedFilesCard 组件（移动端样式）
   - 显示发送方信息（设备名称、IP地址、设备类型）
   - 支持文件预览（图片）
   - 使用系统分享菜单保存文件
   - 支持长按显示操作菜单

## 八、命名建议

### "工作台"命名说明

- **工作台**（Workspace）：推荐使用
  - 含义：用户与设备交互的工作空间
  - 扩展性：可以包含各种功能模块
  - 用户理解：直观易懂

- **控制台**（Console）：备选
  - 含义：设备控制中心
  - 适用场景：更偏向控制类功能

- **设备中心**（Device Center）：备选
  - 含义：设备管理中心
  - 适用场景：更偏向管理类功能

**最终确认**：使用"**工作台**"作为功能名称，不再更改

## 九、移动端界面详细设计

### 9.1 服务状态卡片（移动端）

#### 布局设计

```
┌─────────────────────────────────────┐
│  服务状态                    [运行中] │
│  ┌───────────────────────────────┐ │
│  │  [启动服务]  [停止服务]         │ │
│  │  [添加设备]                     │ │
│  └───────────────────────────────┘ │
│  ┌───────────────────────────────┐ │
│  │  本设备信息                     │ │
│  │  IP: 192.168.1.100:8080  [复制]│ │
│  │  ID: device-xxx        [复制]  │ │
│  └───────────────────────────────┘ │
└─────────────────────────────────────┘
```

#### 设计要点

- 按钮使用全宽或较大尺寸（至少 44px 高度）
- 按钮间距至少 12px
- 状态指示器使用颜色和动画（绿色脉冲表示运行中）
- 信息区域可折叠（节省空间）
- 复制按钮使用图标，点击后显示 Toast 提示

### 9.2 设备列表项（移动端）

#### 布局设计

```
┌─────────────────────────────────────┐
│  [图标]  设备名称                    │
│         地址:端口  |  类型           │
│  ┌───────────────────────────────┐  │
│  │ [测试连接] [文件传输] [工作台] │  │
│  └───────────────────────────────┘  │
└─────────────────────────────────────┘
```

#### 设计要点

- 设备信息垂直排列，清晰易读
- 按钮组使用全宽，三个按钮横向排列
- 按钮文字清晰，图标辅助说明
- 支持长按显示操作菜单（编辑、删除、复制信息）
- 支持左滑显示删除按钮（可选）

### 9.3 工作台界面（移动端）

#### 布局设计

```
┌─────────────────────────────────────┐
│  [←] 设备名称            [连接状态]  │ ← 顶部固定
├─────────────────────────────────────┤
│                                     │
│  消息区域（可滚动）                  │
│  ┌─────────┐                        │
│  │ 文本消息 │                        │
│  └─────────┘                        │
│            ┌─────────┐              │
│            │ 文件消息│              │
│            └─────────┘              │
│                                     │
├─────────────────────────────────────┤
│  [📎] [输入框...]          [发送]    │ ← 底部固定
└─────────────────────────────────────┘
```

#### 设计要点

- **全屏显示**：占据整个屏幕，提供沉浸式体验
- **顶部固定**：设备信息和返回按钮固定在顶部
- **消息区域**：占据主要空间，支持滚动
- **底部固定**：输入区域固定在底部，键盘上方
- **键盘适配**：键盘弹出时自动调整布局
- **消息气泡**：左右对齐，区分发送和接收
- **自动滚动**：新消息自动滚动到底部

### 9.4 接收文件列表（移动端）

#### 布局设计

```
┌─────────────────────────────────────┐
│  接收的文件 (3)          [展开/收起] │
├─────────────────────────────────────┤
│  [📄] 文件名.pdf                    │
│       1.2 MB  |  2024-01-01 12:00  │
│       来自: 我的电脑 (192.168.1.100) │
│       [下载]                        │
├─────────────────────────────────────┤
│  [🖼️] 图片.jpg                     │
│       500 KB  |  2024-01-01 11:30  │
│       来自: 手机设备 (192.168.1.101)│
│       [预览] [下载]                 │
└─────────────────────────────────────┘
```

#### 设计要点

- **可折叠设计**：默认折叠，点击展开
- **文件图标**：根据文件类型显示不同图标
- **文件信息**：显示文件名、大小、接收时间
- **发送方信息**：显示发送设备名称和IP地址（格式：来自: 设备名称 (IP地址)）
- **操作按钮**：图片支持预览，所有文件支持下载
- **长按菜单**：长按文件项显示操作菜单（保存、分享、删除）

### 9.5 文件传输快速入口（移动端）

#### 流程设计

1. **文件选择**
   - 使用系统原生文件选择器
   - 支持多选（Android/iOS 都支持）
   - 支持访问相册、文档、下载等目录

2. **传输进度**
   - 显示在应用内（不阻塞界面）
   - 使用 Toast 或底部通知栏显示
   - 显示当前文件、进度百分比、传输速度

3. **队列管理**
   - 多个文件按顺序发送
   - 显示队列中的文件数量
   - 支持取消传输

### 9.6 移动端与桌面端的主要差异总结

| 特性         | 桌面端              | 移动端                |
| ------------ | ------------------- | --------------------- |
| **布局方式** | 横向布局，多列显示  | 纵向布局，单列显示    |
| **按钮尺寸** | 标准尺寸（32-40px） | 较大尺寸（至少 44px） |
| **工作台**   | 大窗口或全屏覆盖    | 全屏显示              |
| **文件选择** | 系统对话框          | 系统文件选择器        |
| **通知方式** | 应用内提示          | Toast + 系统通知      |
| **键盘处理** | 标准处理            | 需要适配键盘弹出      |
| **手势支持** | 鼠标操作            | 触摸 + 手势           |
| **安全区域** | 无需适配            | 需要适配刘海屏等      |

## 十、文件接收发送方信息设计

### 10.1 发送方信息显示规范

#### 信息内容

接收文件时，需要显示以下发送方信息：

- **设备名称**：发送文件的设备名称（如"我的电脑"、"手机设备"）
- **设备IP地址**：发送文件的设备IP地址（如"192.168.1.100"）
- **设备端口**：发送文件的设备端口（如"8080"）
- **设备类型**：发送文件的设备类型（桌面端/移动端）
- **接收时间**：文件接收的完整时间戳

#### 显示格式

**桌面端格式：**

```
来自: 设备名称 (IP地址:端口)
类型: 桌面端 | 接收时间: 2024-01-01 12:00:00
```

**移动端格式：**

```
来自: 设备名称 (IP地址:端口)
类型: 移动端 | 接收时间: 2024-01-01 12:00
```

#### 布局位置

- **桌面端**：在文件信息下方，使用较小字体（12-13px），灰色文字
- **移动端**：在文件信息下方，使用较小字体（12px），灰色文字
- **可折叠**：如果信息较多，可以折叠显示，点击展开查看详情

### 10.2 发送方信息在文件列表中的显示

#### 桌面端文件列表项

```
┌─────────────────────────────────────────────────┐
│  [📄] 文件名.pdf                    [下载]      │
│       1.2 MB  |  2024-01-01 12:00:00            │
│       来自: 我的电脑 (192.168.1.100:8080)      │
│       类型: 桌面端                              │
└─────────────────────────────────────────────────┘
```

#### 移动端文件列表项

```
┌─────────────────────────────────────┐
│  [📄] 文件名.pdf                    │
│       1.2 MB  |  2024-01-01 12:00  │
│       来自: 我的电脑                │
│       (192.168.1.100:8080)         │
│       [下载]                        │
└─────────────────────────────────────┘
```

### 10.3 发送方信息在工作台中的显示

#### 文件消息气泡（桌面端）

```
┌─────────────────────────────────────┐
│  [📄] 文件名.pdf                    │
│       1.2 MB                        │
│       来自: 我的电脑                │
│       (192.168.1.100:8080)         │
│       [下载]                        │
│       12:00                         │
└─────────────────────────────────────┘
```

#### 文件消息气泡（移动端）

```
┌─────────────────────────────────────┐
│  [📄] 文件名.pdf                    │
│       1.2 MB                        │
│       来自: 我的电脑                │
│       (192.168.1.100:8080)         │
│       [下载]                        │
│       12:00                         │
└─────────────────────────────────────┘
```

### 10.4 发送方信息的数据来源

#### 后端数据

- **TCP连接信息**：从TCP连接中获取发送方的IP地址和端口
- **设备发现服务**：通过mDNS或设备列表匹配IP地址，获取设备名称和类型
- **时间戳**：服务器端记录文件接收的准确时间

#### 前端显示

- **设备匹配**：根据IP地址和端口在设备列表中查找匹配的设备
- **信息回填**：如果找到匹配设备，显示设备名称和类型；否则显示IP地址和端口
- **缓存机制**：缓存发送方信息，避免重复查询

### 10.5 发送方信息的交互功能

#### 可点击操作

- **点击设备名称**：如果设备在列表中，可以快速打开该设备的工作台
- **点击IP地址**：复制IP地址到剪贴板
- **悬停显示**：桌面端悬停显示完整信息（设备ID、完整时间戳等）

#### 移动端特殊处理

- **长按信息**：长按发送方信息显示操作菜单（复制IP、打开工作台等）
- **点击复制**：点击IP地址区域快速复制

## 十一、空状态（EmptyState）界面设计

### 11.0 初始 EmptyState（启动服务入口）

#### 桌面端设计

```
┌─────────────────────────────────────────────────┐
│                                                   │
│              [📱]                                │
│            (64x64px)                             │
│                                                   │
│          欢迎使用 Stationuli                      │
│         (18px, 粗体)                             │
│                                                   │
│    启动服务以开始使用文件传输和设备连接功能        │
│         (14px, 灰色)                             │
│                                                   │
│         [启动服务]                                │
│      (按钮，主要操作，居中)                       │
│                                                   │
└─────────────────────────────────────────────────┘
```

#### 移动端设计

```
┌─────────────────────────────────────┐
│                                       │
│            [📱]                       │
│          (80x80px)                   │
│                                       │
│       欢迎使用 Stationuli             │
│       (16px, 粗体)                    │
│                                       │
│  启动服务以开始使用文件传输和设备连接功能│
│       (14px, 灰色)                    │
│                                       │
│       [启动服务]                      │
│    (全宽按钮，44px高)                 │
│                                       │
└─────────────────────────────────────┘
```

#### 设计要点

- **图标**：使用设备图标（📱）
- **主标题**：欢迎文字，如"欢迎使用 Stationuli"
- **副标题**：说明功能，如"启动服务以开始使用文件传输和设备连接功能"
- **唯一操作**：只显示"启动服务"按钮
- **自动切换**：启动服务成功后自动切换到应用主页
- **服务启动后**：如果服务已启动，显示本设备信息（作为过渡信息）

### 11.1 设计原则

#### 通用原则

- **友好提示**：使用清晰的图标和文字说明当前状态
- **引导操作**：提供明确的操作指引，告诉用户下一步该做什么
- **视觉平衡**：保持视觉层次清晰，避免过于拥挤或空旷
- **品牌一致性**：使用统一的视觉风格和配色方案

#### 移动端特殊考虑

- **图标尺寸**：使用较大的图标（64-80px），便于识别
- **文字大小**：主标题至少 16px，副标题至少 14px
- **触摸友好**：操作按钮使用较大的触摸区域
- **空间利用**：合理利用屏幕空间，避免过度留白

#### 桌面端特殊考虑

- **图标尺寸**：使用中等尺寸图标（48-64px）
- **文字大小**：主标题至少 18px，副标题至少 14px
- **交互提示**：可以使用悬停效果和动画
- **信息密度**：可以显示更多辅助信息

### 11.2 设备列表为空状态

#### 桌面端设计

```
┌─────────────────────────────────────────────────┐
│                                                   │
│              [📭]                                │
│            (64x64px)                             │
│                                                   │
│           暂无设备                                │
│         (18px, 粗体)                             │
│                                                   │
│    点击"添加设备"按钮手动添加其他设备              │
│         (14px, 灰色)                             │
│                                                   │
│         [添加设备]                                │
│      (按钮，主要操作)                             │
│                                                   │
└─────────────────────────────────────────────────┘
```

#### 移动端设计

```
┌─────────────────────────────────────┐
│                                       │
│            [📭]                       │
│          (80x80px)                   │
│                                       │
│         暂无设备                      │
│       (16px, 粗体)                    │
│                                       │
│  点击"添加设备"按钮手动添加其他设备    │
│       (14px, 灰色)                    │
│                                       │
│       [添加设备]                      │
│    (全宽按钮，44px高)                 │
│                                       │
└─────────────────────────────────────┘
```

#### 设计要点

- **图标**：使用空文件夹或设备图标（📭 或 📱）
- **主标题**：简洁明了，如"暂无设备"
- **副标题**：提供操作指引，如"点击'添加设备'按钮手动添加其他设备"
- **操作按钮**：提供主要操作入口（添加设备按钮）
- **视觉层次**：图标 → 主标题 → 副标题 → 操作按钮

### 11.3 接收文件列表为空状态

#### 桌面端设计

```
┌─────────────────────────────────────────────────┐
│                                                   │
│              [📥]                                │
│            (64x64px)                             │
│                                                   │
│         暂无接收的文件                            │
│         (18px, 粗体)                             │
│                                                   │
│    接收到的文件将显示在这里                        │
│         (14px, 灰色)                             │
│                                                   │
└─────────────────────────────────────────────────┘
```

#### 移动端设计

```
┌─────────────────────────────────────┐
│                                       │
│            [📥]                       │
│          (80x80px)                   │
│                                       │
│       暂无接收的文件                  │
│       (16px, 粗体)                    │
│                                       │
│  接收到的文件将显示在这里              │
│       (14px, 灰色)                    │
│                                       │
└─────────────────────────────────────┘
```

#### 设计要点

- **图标**：使用下载或收件箱图标（📥 或 📬）
- **主标题**：如"暂无接收的文件"
- **副标题**：说明功能，如"接收到的文件将显示在这里"
- **无需操作按钮**：这是被动接收的状态，不需要主动操作

### 11.4 工作台消息为空状态

#### 桌面端设计

```
┌─────────────────────────────────────────────────┐
│  设备名称                            [连接状态]  │
├─────────────────────────────────────────────────┤
│                                                   │
│              [💬]                                │
│            (64x64px)                             │
│                                                   │
│           开始聊天吧！                            │
│         (18px, 粗体)                             │
│                                                   │
│    发送文本消息或文件开始与设备交互                │
│         (14px, 灰色)                             │
│                                                   │
├─────────────────────────────────────────────────┤
│  [📎] [输入框...]                    [发送]      │
└─────────────────────────────────────────────────┘
```

#### 移动端设计

```
┌─────────────────────────────────────┐
│  [←] 设备名称            [连接状态]  │
├─────────────────────────────────────┤
│                                       │
│            [💬]                       │
│          (80x80px)                   │
│                                       │
│         开始聊天吧！                  │
│       (16px, 粗体)                    │
│                                       │
│  发送文本消息或文件开始与设备交互      │
│       (14px, 灰色)                    │
│                                       │
├─────────────────────────────────────┤
│  [📎] [输入框...]          [发送]    │
└─────────────────────────────────────┘
```

#### 设计要点

- **图标**：使用聊天或对话图标（💬 或 💭）
- **主标题**：鼓励性文字，如"开始聊天吧！"
- **副标题**：说明功能，如"发送文本消息或文件开始与设备交互"
- **输入区域可见**：保持输入框可见，引导用户操作
- **友好氛围**：使用轻松友好的语言

### 11.5 文件传输队列为空状态

#### 桌面端设计

```
┌─────────────────────────────────────────────────┐
│                                                   │
│              [📤]                                │
│            (64x64px)                             │
│                                                   │
│         暂无待传输的文件                          │
│         (18px, 粗体)                             │
│                                                   │
│    点击"文件传输"按钮选择要发送的文件              │
│         (14px, 灰色)                             │
│                                                   │
└─────────────────────────────────────────────────┘
```

#### 移动端设计

```
┌─────────────────────────────────────┐
│                                       │
│            [📤]                       │
│          (80x80px)                   │
│                                       │
│       暂无待传输的文件                │
│       (16px, 粗体)                    │
│                                       │
│  点击"文件传输"按钮选择要发送的文件    │
│       (14px, 灰色)                    │
│                                       │
└─────────────────────────────────────┘
```

#### 设计要点

- **图标**：使用上传或发送图标（📤 或 ⬆️）
- **主标题**：如"暂无待传输的文件"
- **副标题**：提供操作指引
- **上下文相关**：根据使用场景调整提示文字

### 11.6 搜索无结果状态

#### 桌面端设计

```
┌─────────────────────────────────────────────────┐
│                                                   │
│              [🔍]                                │
│            (64x64px)                             │
│                                                   │
│         未找到匹配的设备                          │
│         (18px, 粗体)                             │
│                                                   │
│    尝试调整搜索关键词或清除筛选条件                │
│         (14px, 灰色)                             │
│                                                   │
│         [清除筛选]                                │
│      (按钮，次要操作)                             │
│                                                   │
└─────────────────────────────────────────────────┘
```

#### 移动端设计

```
┌─────────────────────────────────────┐
│                                       │
│            [🔍]                       │
│          (80x80px)                   │
│                                       │
│       未找到匹配的设备                │
│       (16px, 粗体)                    │
│                                       │
│  尝试调整搜索关键词或清除筛选条件      │
│       (14px, 灰色)                    │
│                                       │
│       [清除筛选]                      │
│    (按钮，次要操作)                   │
│                                       │
└─────────────────────────────────────┘
```

#### 设计要点

- **图标**：使用搜索图标（🔍）
- **主标题**：如"未找到匹配的设备"或"未找到匹配的文件"
- **副标题**：提供解决建议
- **操作按钮**：提供清除筛选或重新搜索的选项

### 11.7 网络错误状态

#### 桌面端设计

```
┌─────────────────────────────────────────────────┐
│                                                   │
│              [⚠️]                                │
│            (64x64px)                             │
│                                                   │
│         网络连接失败                               │
│         (18px, 粗体)                             │
│                                                   │
│    请检查网络连接后重试                            │
│         (14px, 灰色)                             │
│                                                   │
│         [重试]                                    │
│      (按钮，主要操作)                             │
│                                                   │
└─────────────────────────────────────────────────┘
```

#### 移动端设计

```
┌─────────────────────────────────────┐
│                                       │
│            [⚠️]                       │
│          (80x80px)                   │
│                                       │
│       网络连接失败                    │
│       (16px, 粗体)                    │
│                                       │
│  请检查网络连接后重试                  │
│       (14px, 灰色)                    │
│                                       │
│       [重试]                          │
│    (全宽按钮，44px高)                 │
│                                       │
└─────────────────────────────────────┘
```

#### 设计要点

- **图标**：使用警告或错误图标（⚠️ 或 ❌）
- **主标题**：明确说明错误类型
- **副标题**：提供解决建议
- **操作按钮**：提供重试或刷新选项
- **错误类型**：区分网络错误、权限错误、服务器错误等

### 11.8 空状态设计规范总结

#### 视觉规范

| 元素           | 桌面端     | 移动端       |
| -------------- | ---------- | ------------ |
| **图标尺寸**   | 48-64px    | 64-80px      |
| **主标题字体** | 18px, 粗体 | 16px, 粗体   |
| **副标题字体** | 14px, 常规 | 14px, 常规   |
| **按钮高度**   | 36-40px    | 44px（最小） |
| **垂直间距**   | 24-32px    | 20-24px      |
| **水平边距**   | 32-48px    | 16-24px      |

#### 颜色规范

- **图标颜色**：灰色（#9CA3AF）或主题色
- **主标题颜色**：深灰色（#374151）或黑色
- **副标题颜色**：中灰色（#6B7280）
- **按钮颜色**：主题色（蓝色/绿色）

#### 交互规范

- **可点击元素**：提供明确的视觉反馈（悬停、点击效果）
- **操作按钮**：使用主要按钮样式，突出显示
- **动画效果**：可以使用轻微的淡入动画（可选）
- **响应式**：适配不同屏幕尺寸

#### 文案规范

- **简洁明了**：使用简短、清晰的文字
- **积极正面**：使用鼓励性语言，避免负面词汇
- **操作导向**：明确告诉用户下一步该做什么
- **上下文相关**：根据具体场景调整文案
